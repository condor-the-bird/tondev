<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>Node.js - TON DEV Knowledge-base</title>
        <link href="../../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../../..">TON DEV Knowledge-base</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../../..">Home</a>
                            </li>
                            <li >
                                <a href="../../../../Glossary/">The Moonspeak</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Compilers <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../Compilers/About/">Intro</a>
</li>
                                    
<li >
    <a href="../../../../Compilers/Linker CLI/">Linker CLI</a>
</li>
                                    
<li >
    <a href="../../../../Compilers/Specification of ABI/">Specification of ABI</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">LLVM Compiler</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../Compilers/LLVM Compiler/C Support Status/">Language Features</a>
</li>
            
<li >
    <a href="../../../../Compilers/LLVM Compiler/C to TVM Library/">C to TVM Library</a>
</li>
            
<li >
    <a href="../../../../Compilers/LLVM Compiler/Compiler Highlights/">Compiler Highlights</a>
</li>
            
<li >
    <a href="../../../../Compilers/LLVM Compiler/Debugging Options/">Debugging Options</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Solidity Compiler</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../Compilers/Solidity-Compiler/Reference Guide/">Reference Guide</a>
</li>
            
<li >
    <a href="../../../../Compilers/Solidity-Compiler/Solidity Support Status/">Solidity Support Status</a>
</li>
            
<li >
    <a href="../../../../Compilers/Solidity-Compiler/Usage/">Usage</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">FAQ <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../FAQ/SDK and Integration/">SDK and Integration</a>
</li>
                                    
<li >
    <a href="../../../../FAQ/Smart Contracts/">Smart Contracts</a>
</li>
                                    
<li >
    <a href="../../../../FAQ/Solidity Compiler/">Solidity Compiler</a>
</li>
                                    
<li >
    <a href="../../../../FAQ/TON and TVM/">TON and TVM</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">SDK <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../Installation/">Installation</a>
</li>
                                    
<li >
    <a href="../../../Overview/">Overview</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Auxiliaries</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Auxiliaries/Getting Logs/">Getting Logs</a>
</li>
            
<li >
    <a href="../../../Auxiliaries/Installing Ubuntu VM/">Installing Ubuntu VM</a>
</li>
            
<li >
    <a href="../../../Auxiliaries/TON SDK CLI/">TON SDK CLI</a>
</li>
            
<li >
    <a href="../../../Auxiliaries/Troubleshooting/">Troubleshooting</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Client Libraries</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">Library Modules</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../Library Modules/Contracts/">Contracts</a>
</li>
            
<li >
    <a href="../../Library Modules/Crypto/">Crypto</a>
</li>
            
<li >
    <a href="../../Library Modules/Overview/">Overview</a>
</li>
            
<li >
    <a href="../../Library Modules/Queries/">Queries</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#">Using Libraries</a>
    <ul class="dropdown-menu">
            
<li class="active">
    <a href="./">Node.js</a>
</li>
            
<li >
    <a href="../Rust/">Rust</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Local node</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Local node/Local Node/">Local Node</a>
</li>
            
<li >
    <a href="../../../Local node/Node SE Giver/">Node SE Giver</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TON Labs Testnet</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../TON Labs Testnet/Testnet Giver/">Testnet Giver</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">TON Blockchain <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../TON Blockchain/Gal Calculation Basics/">Gas Calculation Basics</a>
</li>
                                    
<li >
    <a href="../../../../TON Blockchain/Lite Client Guide/">Lite client</a>
</li>
                                    
<li >
    <a href="../../../../TON Blockchain/Replay Attack Protection/">Replay Attack Protection</a>
</li>
                                    
<li >
    <a href="../../../../TON Blockchain/Storage Fee Calculation/">Storage Fee Calculation</a>
</li>
                                    
<li >
    <a href="../../../../TON Blockchain/TON Blockchain/">TON Blockchain</a>
</li>
                                    
<li >
    <a href="../../../../TON Blockchain/TON Virtual Machine/">Introduction</a>
</li>
                                    
<li >
    <a href="../../../../TON Blockchain/TON Whitepaper/">TON Whitepaper</a>
</li>
                                    
<li >
    <a href="../../../../TON Blockchain/TVM Error Codes/">TVM Error Codes</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../../Library Modules/Queries/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../Rust/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#creating-a-contract">Creating a contract</a></li>
        <li class="main "><a href="#creating-an-app">Creating an app</a></li>
        <li class="main "><a href="#deployment">Deployment</a></li>
        <li class="main "><a href="#running-a-contract">Running a contract</a></li>
        <li class="main "><a href="#querying-blockchain">Querying blockchain</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Follow guidelines in this section to create your own environment based on Node.js with the Node SE tools and to develop your first test contract. </p>
<p>First and foremost, create a local folder for all your test projects. Note that in this documentation the sample folder is called <strong>ton-dev</strong>. If your folder has a different name, make sure to edit the code accordingly.</p>
<h2 id="creating-a-contract">Creating a contract</h2>
<ol>
<li>Create "hello" folder and place the "hello.sol" contract source code into it:</li>
</ol>
<pre><code class="javascript">pragma solidity &gt;=0.5.0 &lt;0.6.0;
contract HelloTON {
    uint32 deployTime;
  constructor() public {
        deployTime = uint32(now);
    }
    function sayHello() public view returns (uint32) {
        return deployTime;
    }
}
</code></pre>

<p>â€‹      </p>
<iframe class="no-border max-full-width full-height flex-grow" src="https://www.youtube.com/embed/TyMOi1kLz20?autohide=1&amp;showinfo=0&amp;rel=0&amp;fs=0" style="max-width: 100%; height: 346px; -webkit-box-flex: 1; flex-grow: 1; border: none;"></iframe>

<ol>
<li>
<p>Call <code>cd hello</code> to navigate to the new folder.</p>
</li>
<li>
<p>Run TON labs Sol2TVM compiler:</p>
</li>
</ol>
<pre><code class="shell">tondev sol hello -l js -L deploy
</code></pre>

<p><code>-l js</code> option is used to generate JavaScript client helper code for the compiled contract.</p>
<p><code>-L deploy is</code> used to include an <code>imageBase64</code> field into the generated JavaScript contract client code.</p>
<h2 id="creating-an-app">Creating an app</h2>
<p>Before being able to play with a smart contract on the blockchain, we need a blockchain infrastructure for contract testing and debugging.</p>
<p>Make sure that you started a local node instance according to the guidelines provided in the <a href="https://docs.ton.dev/86757ecb2/p/28b6ba"><strong>Installation</strong></a> section.</p>
<pre><code class="shell">tondev start
</code></pre>

<p>Let's start with Node.js to show how to build a test application, deploy and run its smart contract.</p>
<blockquote>
<p><strong>Note:</strong> To create an application according to this procedure, you have to install Node.js. It is recommended to have the latest version.</p>
</blockquote>
<ol>
<li>Let's initialize a Node.js application:</li>
</ol>
<pre><code class="shell">~/ton-dev/hello$ touch index.js
~/ton-dev/hello$ npm init
</code></pre>

<p>Add a section to package.json:</p>
<pre><code class="shell">
&quot;dependencies&quot;: { &quot;ton-client-node-js&quot;: &quot;^0.12.1&quot;}
</code></pre>

<p>Then execute (in the project folder):</p>
<pre><code class="shell">~/ton-dev/hello$ npm install 
</code></pre>

<p>\2. Connect to Node SE or to TON Labs testnet. In JS Client Libraries the <code>TONClient</code>class is used to connect to TON Blockchain node, that can work with SDK. </p>
<p>If you use the local node (NodeSE), specify <code>'&lt;http://0.0.0.0&gt;'</code> in the following code:</p>
<pre><code class="javascript">const client = new TONClient();
    client.config.setData({
        servers: ['&lt;http://0.0.0.0&gt;']
    });
</code></pre>

<blockquote>
<p><strong>Important</strong>: for Windows use <a href="http://127.0.0.1/">http://127.0.0.1/</a> or <a href="http://localhost/">http://localhost</a>.</p>
</blockquote>
<p>If you use TON Labs testnet, specify: <code>servers: ['Node URL'].</code>For testing we use <code>'&lt;https://testnet.ton.dev&gt;'</code>:</p>
<pre><code class="javascript">  const client = new TONClient();
    client.config.setData({
        servers: ['&lt;https://https://testnet.ton.dev&gt;']
    });
</code></pre>

<blockquote>
<p>In JS Client you can simultaneously use several nodes. Create a separate TONClient object for each connection.</p>
</blockquote>
<ol>
<li>Open the "index.js" file in your preferred editor and enter the code below.</li>
</ol>
<pre><code class="javascript">const { TONClient } = require('ton-client-node-js');

async function main(client) {
}

(async () =&gt; {
    try {
        const client = new TONClient();
        client.config.setData({
            servers: ['NodeSE/Testnet URL']
        });
        await client.setup();
        await main(client);
        console.log('Hello TON Done');
    process.exit(0);
    } catch (error) {
        console.error(error);
    }
})();
</code></pre>

<ol>
<li>Run the client app as follows:</li>
</ol>
<pre><code class="shell">~/ton-dev/hello$ node index.js
Hello TON Done
~/ton-dev/hello$

</code></pre>

<h2 id="deployment">Deployment</h2>
<p>Before a contract is deployed, it has to be defined in your node.js application. The necessary elements are: a compatible TVM code and an ABI structure. Both elements were obtained at the compilation stage before in the <code>helloPackage.js</code>file.</p>
<blockquote>
<p><strong>Tip</strong>: For more details on the ABI, see the <a href="https://docs.ton.dev/86757ecb2/p/70c253">specification</a>.</p>
</blockquote>
<p>For deployment, you also have to take the following steps:</p>
<ol>
<li>Generate the key pair. Each time a contract is deployed, you can generate keys with a built-in <code>ton.crypto.ed25519Keypair</code> crypto module.</li>
</ol>
<p>Or use pre-generated keys to get predictable results. It is the option used for this example:</p>
<pre><code class="shell">{
    public: '55d7bab463a6a3ef5e03bb5f975836ddfb589b9ccb00329be7da8ea981c5268a',
    secret: 'de93a97c7103c2d44e47972265cfdfe266fd28c8cadc4875804ee9f57cf786d6',
}
</code></pre>

<ol>
<li>Switch to your test app source code to declare a smart contract package and the relevant key pair:</li>
</ol>
<pre><code class="javascript">...

// Define contract package

const HelloContract = require('./helloContract');

// Define keys for our contract

const helloKeys = {
    public: '55d7bab463a6a3ef5e03bb5f975836ddfb589b9ccb00329be7da8ea981c5268a',
    secret: 'de93a97c7103c2d44e47972265cfdfe266fd28c8cadc4875804ee9f57cf786d6',
};

async function main(client) {
}

...
</code></pre>

<ol>
<li>The contract is almost ready for deployment, but <strong>in TON blockchain you must deposit GRAMs to the address of the deployed contract before the actual deploy</strong>. <strong>Otherwise deploy will fail.</strong> </li>
</ol>
<p>You can send Grams from another contract or use our giver. To learn how to use giver, check the relevant section in the document covering the <a href="https://docs.ton.dev/86757ecb2/p/891ee9">Contracts</a> module. There is a detailed usage example. </p>
<pre><code class="javascript">...

async function main(client) {
    const helloAddress = (await client.contracts.deploy({
        package: HelloContract.package,
        constructorParams: {},
        keyPair: helloKeys,
    })).address;
    console.log(`Hello contract was deployed at address: ${helloAddress}`);
}

...
</code></pre>

<p>Now run to check how it works.</p>
<pre><code class="shell">~/ton-dev/hello$ node index.js
Hello contract was deployed at address: 516c7a2bc72c5728526eb73064da07a2876d964c3da5ed2488e1aba3da20be3f
~/ton-dev/hello$
</code></pre>

<h2 id="running-a-contract">Running a contract</h2>
<p>Running your contract on blockchain is also quite simple</p>
<pre><code class="javascript">...

async function main(client) {
    const helloAddress = (await client.contracts.deploy({
        package: HelloContract.package,
        constructorParams: {},
        keyPair: helloKeys,
    })).address;
    console.log(`Hello contract was deployed at address: ${helloAddress}`);

    const response = await client.contracts.run({
        address: helloAddress,
        abi: HelloContract.package.abi,
        functionName: 'sayHello',
        input: {},
        keyPair: helloKeys,
    });
    console.log('Hello contract was responded to sayHello:', response);
}

...
</code></pre>

<p>Now run the app:</p>
<pre><code class="shell">~/ton-dev/hello$ node index.js
Hello contract was deployed at address: 516c7a2bc72c5728526eb73064da07a2876d964c3da5ed2488e1aba3da20be3f
Hello contract was responded to sayHello: { output: { value0: '0x5d6fba2e' } }
Hello TON Done
~/ton-dev/hello$
</code></pre>

<p>Alternatively, you can run a contract in the TVM instance included into a client library without interaction with TVM node:</p>
<pre><code class="javascript">...

async function main(client) {
    const helloAddress = (await client.contracts.deploy({
        package: HelloContract.package,
        constructorParams: {},
        keyPair: helloKeys,
    })).address;
    console.log(`Hello contract was deployed at address: ${helloAddress}`);

    const response = await client.contracts.run({
        address: helloAddress,
        abi: HelloContract.package.abi,
        functionName: 'sayHello',
        input: {},
        keyPair: helloKeys,
    });
    console.log('Hello contract was responded to sayHello:', response);

    const localResponse = await client.contracts.runLocal({
        address: helloAddress,
        abi: HelloContract.package.abi,
        functionName: 'sayHello',
        input: {},
        keyPair: helloKeys,
    });
    console.log('Hello contract was ran on a client TVM and also responded to sayHello:', localResponse);
}

...
</code></pre>

<p>Run:</p>
<pre><code class="shell">~/ton-dev/hello$ node index.js
Hello contract was deployed at address: 516c7a2bc72c5728526eb73064da07a2876d964c3da5ed2488e1aba3da20be3f
Hello contract was responded to sayHello: { output: { value0: '0x5d6fba2e' } }
Hello contract was ran on a client TVM and also responded to sayHello: { output: { value0: '0x5d6fba2e' } }
Hello TON Done
~/ton-dev/hello$
</code></pre>

<blockquote>
<p>Find more information about deploying and running in the <a href="https://docs.ton.dev/86757ecb2/p/891ee9"><strong>Contracts</strong></a> section.</p>
</blockquote>
<h2 id="querying-blockchain">Querying blockchain</h2>
<p>Each node server is equipped with a database that tracks the relevant blockchain.</p>
<p>This database is accessible through a GraphQL based protocol for querying blockchain.</p>
<p>The Client library contains the Query Module designed to perform GraphQL queries over a blockchain. The simplest way to query a blockchain is using the following <code>query</code> method:</p>
<pre><code class="javascript">async function queries(client) {
    const transactions = await client.queries.transactions.query({}, 'id now status');
    console.log('All Transactions: ', transactions);    
}
</code></pre>

<p>Then all transactions in the relevant blockchain are displayed (the first 50, to be precise). 50  is the default number used when no limit is specified or when it exceeds 50.</p>
<p>For each transaction, we have three result fields: <strong>id</strong>, <strong>now</strong> and <strong>status</strong>.</p>
<p>We have several options to filter the results:</p>
<pre><code class="javascript">const transactions = await client.queries.transactions.query({
    now: { eq: 1567601735 }
}, 'id now status');
console.log('Filtered Transactions: ', transactions);
</code></pre>

<p>The example gets all transactions with <strong>now</strong> equals to 1567601735. </p>
<blockquote>
<p>Find more information about a filtering in the <a href="https://docs.ton.dev/86757ecb2/p/05a847"><strong>Queries</strong></a> section.</p>
</blockquote></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
